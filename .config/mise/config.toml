# ~/.config/mise/config.toml
# Global mise configuration
# Assumes: Homebrew-installed uv, zsh shell, and SOPS-managed secrets

[env]
# Path configurations
SECRETS_DIR = "$HOME/.local/share/secrets"
VENV_CACHE = "${XDG_DATA_HOME:-$HOME/.local/share}/venvs"
# Default package lists
MISE_PYTHON_DEFAULT_PACKAGES_FILE = "~/.config/mise/.default-python-packages"
MISE_NODE_DEFAULT_PACKAGES_FILE = "~/.config/mise/.default-npm-packages"
MISE_GO_DEFAULT_PACKAGES_FILE = "~/.config/mise/.default-go-packages"

# Load multiple secret files, redacted in logs
_.file = [
  { path = "$SECRETS_DIR/.env.json", redact = true },
  { path = "$SECRETS_DIR/.env.dev", redact = true },
]

[hooks.enter]
shell = "zsh"
# Autoloaded function; only runs if the file exists
script = "[ -f $SECRETS_DIR/.env ] && load-secrets"

[tools]
# npm MUST be first to prioritize standalone version over Node's bundled npm
npm = "11.6.2"

# Core runtimes (dependency order matters after npm)
node = { version = "latest", postinstall = "corepack enable" }
python = "latest"
bun = "latest"

# System utilities (fast, independent tools)
ripgrep = "latest"
shellcheck = "latest"
gemini-cli = "latest"
pre-commit = "latest"

# Node.js packages (grouped by function)
# Code formatting & linting
"npm:prettier" = "3"
"npm:markdownlint-cli" = "latest"

# Node.js utilities
"npm:npm-check" = "latest"
"npm:npkill" = "latest"

# AI/MCP tools (may have longer install times)
"npm:@motesoftware/nanocoder" = "latest"
"npm:@pimzino/agentic-tools-mcp" = "latest"

# Python CLI tools (managed via pipx backend with uvx=true)
# "pipx:aider-chat" = "latest"  # TODO: Waiting for tiktoken PyO3 Python 3.14 support
"pipx:basic-memory" = "latest"
"pipx:psf/black" = "latest"
"pipx:gallery-dl" = "latest"
"pipx:khard" = "latest"
"pipx:mac-cleanup" = "latest"
# "pipx:markitdown-mcp" = "latest"  # TODO: Waiting for onnxruntime Python 3.14 wheels
"pipx:osxmetadata" = "latest"
"pipx:rich-cli" = "latest"
"pipx:ruff" = "latest"
"pipx:speedtest-cli" = "latest"
"pipx:yt-dlp" = "latest"

[settings]
# Core settings
experimental = true
always_keep_download = false
always_keep_install = false
verbose = false                              # Set to true only for debugging
http_timeout = "60s"                         # Increase if network is slow
jobs = 4
cache_prune_age = "3d"
activate_aggressive = true
gix = false
python_compile = false
legacy_version_file = true
plugin_autoupdate_last_check_duration = "7d"

[settings.pipx]
uvx = true

[settings.python]
uv_venv_auto = true
uv_venv_create_args = ["--seed"]

[settings.status]
show_env = false
