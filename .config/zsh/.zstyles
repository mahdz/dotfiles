#!/bin/zsh
#
# .zstyles - zstyle settings for features/plugins that need them.
#

#
# Zephyr features
#

# Use caching.
zstyle ':zephyr:plugin:*' 'use-cache' no

#
# Completions
#
# zstyle ':zsh_custom:plugin:*' 'use-cache' no
# zstyle ':zsh_custom:plugin:completion' compstyle zshzoo

# XDG
zstyle ':zephyr:plugin:*' use-xdg-basedirs 'yes'

# Environment
# zstyle ':zephyr:plugin:environment' skip-path-setup yes

# Always show color
zstyle ':zephyr:plugin:*' color 'yes'

#
# Editor
#

# Expand aliases to their actual command like Fish abbreviations.
zstyle ':zephyr:plugin:editor' glob-alias 'yes'
noexpand=(
  ls
  gpg
  vi
  z
  0 1 2 3 4 5 6 7 8 9
)
zstyle ':zephyr:plugin:editor:glob-alias' noexpand "${noexpand[@]}"

# Set the key mapping style to 'emacs' or 'vi'.
zstyle ':zephyr:plugin:editor' key-bindings 'vi'

# Auto convert .... to ../..
zstyle ':zephyr:plugin:editor' dot-expansion 'no'

# Use ^z to return background processes to foreground.
zstyle ':zephyr:plugin:editor' symmetric-ctrl-z 'yes'

# Set the default (magic) command when hitting enter on an empty prompt.
zstyle ':zephyr:plugin:editor' magic-enter 'yes'
# zstyle ':zephyr:plugin:editor:magic-enter' command 'ls -lh .'
# zstyle ':zephyr:plugin:editor:magic-enter' git-command 'git status -u .'

# Editor style
zstyle -s ':zephyr:plugin:editor' key-bindings 'vi'

# From compinit docs:
# To avoid these tests and make all files found be used without asking, use the
# option -u, and to make compinit silently ignore all insecure files and directories
# use the option -i. This security check is skipped entirely when the -C option is
# given, provided the dumpfile exists.
zstyle ':zephyr:plugin:completion' 'disable-compfix' yes
zstyle ':zephyr:plugin:completion' compstyle 'zephyr'

# Dotfiles
zstyle ':zsh_custom:plugin:dotfiles' bare 'yes'

# History
zstyle ':zephyr:plugin:history:alias' skip 'yes'
zstyle ':hist:*' expand-aliases yes
zstyle ':hist:*' auto-format yes

# Environment - configure prepath to include system binaries
# This prevents the environment plugin from removing /usr/bin, /bin, etc from PATH
# zstyle ':zephyr:plugin:environment' 'prepath' \
#   $HOME/bin \
#   $HOME/.local/bin \
#   /usr/local/bin \
#   /usr/bin \
#   /bin \
#   /usr/sbin \
#   /sbin

# aliases
# Enable all aliases in lib and plugins broadly
# zstyle ':omz:lib:*' aliases yes
# zstyle ':omz:plugins:*' aliases yes

# Disable directories aliases from lib
zstyle ':omz:lib:directories' aliases no

# Disable git plugin aliases
zstyle ':omz:plugins:git' aliases no

# GNU
# zstyle ':omz:lib:theme-and-appearance' gnu-ls no
# Prevent use-omz from trying to load themes since we use starship directly
zstyle ':omz:lib:theme-and-appearance' 'skip' 'yes'

# async
# zstyle ':omz:alpha:lib:git' async-prompt no

# ssh-agent
zstyle :omz:plugins:ssh-agent agent-forwarding on
# zstyle :omz:plugins:ssh-agent quiet yes
zstyle :omz:plugins:ssh-agent lazy yes
zstyle :omz:plugins:ssh-agent ssh-add-args --apple-load-keychain

# # Pre-set completion performance options that don't require compinit
zstyle ':completion:*' accept-exact '*(N)'
zstyle ':completion:*' use-perl on
zstyle ':completion:*' menu select

# # Completion system performance tweaks
zstyle ':completion:*' matcher-list 'm:{a-zA-Z}={A-Za-z}' # Case insensitive matching
zstyle ':completion:*' rehash true
zstyle ':completion:*' special-dirs true
zstyle ':completion:*' squeeze-slashes true
if [[ -n ${LS_COLORS:-} ]]; then
  zstyle ':completion:*' list-colors "${(s.:.)LS_COLORS}"
fi
zstyle ':completion:*:functions' ignored-patterns '(_*|pre(cmd|exec)|prompt_*)'

# # Group matches and describe
zstyle ':completion:*' group-name ''
zstyle ':completion:*:descriptions' format '%F{yellow}completing %B%d%b%f'

# # Speed up path completion by avoiding glob patterns
zstyle ':completion:*:paths' accept-exact-dirs true

#
# ZSH_CUSTOM features
#

# git
zstyle ':zsh_custom:plugin:git' default-user mahdz

# zshrc.d location
zstyle ':zsh_custom:plugin:zshrcd' directory "$ZDOTDIR/zshrc.d"

# zfunctions location
zstyle ':zsh_custom:plugin:zfunctions' directory "$ZDOTDIR/functions"

#
# Prompt
#

# Set prompt
zstyle ':zephyr:plugin:prompt' theme starship gruvbox-rainbow
