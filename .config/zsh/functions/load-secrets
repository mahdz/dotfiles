#!/usr/bin/env zsh
# load-secrets - Load SOPS-encrypted environment variables
#
# Usage: load-secrets
#
# Loads environment variables from SOPS-encrypted .env file
# Location: ${SECRETS_FILE:-$HOME/.local/share/secrets/.env}

local f="${SECRETS_FILE:-$HOME/.local/share/secrets/.env}"

if [[ ! -f "$f" ]]; then
  echo "Secrets file not found: $f" >&2
  return 1
fi

if ! command -v sops >/dev/null 2>&1; then
  echo "sops not installed" >&2
  return 1
fi

local keyf="${SOPS_AGE_KEY_FILE:-$HOME/.config/sops/age/keys.txt}"
if [[ ! -f "$keyf" ]]; then
  echo "age key not found: $keyf" >&2
  return 1
fi

# Load variables with automatic export
set -a
SOPS_AGE_KEY_FILE="$keyf" source <(sops -d "$f")
set +a

echo "âœ… Secrets loaded from $f"
