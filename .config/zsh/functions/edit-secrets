#!/usr/bin/env zsh
# edit-secrets - Edit SOPS-encrypted environment variables
#
# Usage: edit-secrets
#
# Opens the SOPS-encrypted .env file for editing
# Location: ${SECRETS_FILE:-$HOME/.config/security/.env.json}

local f="${SECRETS_FILE:-$HOME/.local/share/secrets/.env}"
local keyf="${SOPS_AGE_KEY_FILE:-$HOME/.config/sops/age/keys.txt}"

if [[ ! -f "$keyf" ]]; then
  echo "âŒ age key not found: $keyf" >&2
  return 1
fi

local dir="$(dirname "$f")"
mkdir -p "$dir"
chmod 700 "$dir"

# Use sops' built-in editor flag instead of assuming EDITOR supports --wait
SOPS_AGE_KEY_FILE="$keyf" sops "$f"
