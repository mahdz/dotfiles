#!/usr/bin/env zsh
# edit-secrets - Edit SOPS-encrypted environment variables
#
# Usage: edit-secrets
#
# Opens the SOPS-encrypted .env file for editing
# Location: ${SECRETS_FILE:-$HOME/.config/security/.env.json}

local f="${SECRETS_FILE:-$HOME/.config/security/.env}"
local keyf="${SOPS_AGE_KEY_FILE:-$HOME/.config/sops/age/keys.txt}"

if [[ ! -f "$keyf" ]]; then
  echo "âŒ age key not found: $keyf" >&2
  return 1
fi

mkdir -p "$(dirname "$f")"; chmod 700 "$(dirname "$f")"

SOPS_AGE_KEY_FILE="$keyf" EDITOR="${EDITOR:-vim} --wait" sops "$f"
