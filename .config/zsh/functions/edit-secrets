#!/usr/bin/env zsh
# edit-secrets - Edit SOPS-encrypted environment variables
#
# Usage: edit-secrets
#
# Opens the SOPS-encrypted .env file for editing
# Location: ${SECRETS_FILE:-$HOME/.local/share/secrets/.env}

local f="${SECRETS_FILE:-$HOME/.local/share/secrets/.env}"
local keyf="${SOPS_AGE_KEY_FILE:-$HOME/.config/sops/age/keys.txt}"

if [[ ! -f "$keyf" ]]; then
  echo "age key not found: $keyf" >&2
  return 1
fi

# Create the secrets directory if it doesn't exist
if [[ ! -d "$(dirname "$f")" ]]; then
  mkdir -p "$(dirname "$f")"
  chmod 700 "$(dirname "$f")"
fi

# Edit with SOPS
SOPS_AGE_KEY_FILE="$keyf" sops "$f"
